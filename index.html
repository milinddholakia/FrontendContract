<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Voting DApp</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src='main.js'></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.1.umd.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript">

    </script>
</head>

<body>
    <h1> Hello Welcome to our Voting Website .</h1><br>
    <h1 id="metamask"></h1>
    <h2>There are two candidates </h2>
    <p>
        <i>Candidate A</i><br>
        <i>Candidate B</i><br>
    </p>
    <p>
        <br>
        Whom would you like to vote?
        <br>
        <button id="voteCandidateA">Candidate A</button> &nbsp;

        <button id="voteCandidateB">Candidate B</button>
    <h3 id="voteSuccess"></h3>
    <h3 id="error"></h3>
    </p>
    <p>
        Click here to see real time results
        <button id="result"> Show Results</button>
    <h3 id="candidateA"></h3>
    <h3 id="candidateB"></h3>
    </p>
</body>
<script>
    const network = "ropsten";
    try {
        let provider;
        window.ethereum.enable().then(provider = new ethers.providers.Web3Provider(window.ethereum));
        const signer = provider.getSigner();

        var contractAddress = "0x4c96Ac9436E3b32a5E004B79eBa2f09853fc7D91";
        var contractAbi = [{ "inputs": [], "stateMutability": "nonpayable", "type": "constructor" }, { "inputs": [], "name": "A", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "B", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "string", "name": "contestant", "type": "string" }], "name": "Vote", "outputs": [{ "internalType": "string", "name": "s", "type": "string" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "", "type": "address" }], "name": "check", "outputs": [{ "internalType": "address", "name": "person", "type": "address" }, { "internalType": "string", "name": "voteGiven", "type": "string" }], "stateMutability": "view", "type": "function" }];
        const connectContract = new ethers.Contract(contractAddress, contractAbi, signer);
        console.log(connectContract);
        console.log(provider);
        async function result() {
            valueA = await connectContract.A();
            $("#candidateA").html("Candidate A :" + valueA.toString());
            const valueB = await connectContract.B();
            $("#candidateB").html("Candidate B :" + valueB.toString());
        }
        async function voteCandidateA() {
            try {
                tx = await connectContract.Vote("A");
                alert("Successfully Voted to Candidate A");
                console.log(tx);
            } catch (err) {
                console.error(err.message);
                alert("Oops . Already Voted from this address!!");
            }
        }
        async function voteCandidateB() {
            try {
                tx = await connectContract.Vote("B");
                console.log(tx);
                alert("Successfully Voted to Candidate B");

            } catch (err) {
                console.error(err.message);
                alert("Oops . Already Voted from this address!!");
            }
        }

        $("#result").click(function () {
            result();
        })
        $("#voteCandidateA").click(function () {
            voteCandidateA();
        })
        $("#voteCandidateB").click(function () {
            voteCandidateB();
        })
    }
    catch (err) {
        console.log("Download metamask plugin");
        alert("Download Metamask and try again later");

        $("#metamask").html("Please install plugin to continue");
        document.getElementById("voteCandidateA").disabled = true;
        document.getElementById("voteCandidateB").disabled = true;
        document.getElementById("result").disabled = true;
        window.open("https://metamask.io/download", '_blank');
        alert("Reload the page once you download the plugin");


    }

</script>

</html>